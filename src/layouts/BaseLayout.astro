---
const {
  title = 'Comedor Luna',
  description = 'Sabores que cuentan historias familiares',
} = Astro.props;
import '../styles/global.css';
import { WhatsAppButton } from '../components/react/WhatsappButton.tsx';
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href={`${import.meta.env.BASE_URL}favicon.ico`} sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href={`${import.meta.env.BASE_URL}favicon-32x32.png`} />
    <link rel="icon" type="image/png" sizes="16x16" href={`${import.meta.env.BASE_URL}favicon-16x16.png`} />
    <link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}apple-touch-icon.png`} />


    <title>{title}</title>
    <meta name="description" content={description} />

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="font-sans bg-cream text-text">
    <slot />
    <WhatsAppButton client:load />
    <script is:inline>
      (() => {
        // evita doble init si hay navegaciÃ³n tipo SPA
        if (window.__revealInit) return;
        window.__revealInit = true;

        const reduce = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;

        const markVisible = (el) => el.classList.add('is-inview');

        const scan = (root = document) => root.querySelectorAll?.('[data-animate]')?.forEach((el) => {
          // si ya estÃ¡ visible, no jodas
          if (el.classList.contains('is-inview')) return;
          io.observe(el);
        });

        if (reduce) {
          document.querySelectorAll('[data-animate]').forEach(markVisible);
          return;
        }

        const io = new IntersectionObserver((entries) => {
          for (const e of entries) {
            if (!e.isIntersecting) continue;
            markVisible(e.target);
            io.unobserve(e.target);
          }
        }, { threshold: 0.15, rootMargin: '0px 0px -10% 0px' });

        scan(document);

        // por si algo se renderiza despuÃ©s (islas React, etc.)
        const mo = new MutationObserver((muts) => {
          for (const m of muts) {
            for (const n of m.addedNodes) {
              if (n.nodeType !== 1) continue;
              scan(n);
            }
          }
        });
        mo.observe(document.documentElement, { childList: true, subtree: true });
      })();

      (() => {
        if (window.__tabTitleLoopInit) return;
        window.__tabTitleLoopInit = true;

        const baseTitle = document.title || "Comedor Luna";
        const awayTitle = "Volve! Te extraÃ±amos ðŸ˜­ðŸ’”";

        let intervalId = null;
        let showAway = true;

        const startLoop = () => {
          if (intervalId) return;

          // Cambia inmediatamente al irse
          document.title = awayTitle;
          showAway = false;

          intervalId = window.setInterval(() => {
            document.title = showAway ? awayTitle : baseTitle;
            showAway = !showAway;
          }, 2000);
        };

        const stopLoop = () => {
          if (!intervalId) return;
          clearInterval(intervalId);
          intervalId = null;
          document.title = baseTitle;
          showAway = true;
        };

        document.addEventListener("visibilitychange", () => {
          if (document.hidden) startLoop();
          else stopLoop();
        });

        // Por si carga ya hidden (caso raro)
        if (document.hidden) startLoop();
      })();
    </script>
  </body>
</html>
